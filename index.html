<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Smart Task Manager Dark Mode</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
<style>
  /* ===== General ===== */
  body {
    font-family: 'Roboto', sans-serif;
    background: #0d1b2a;
    color: #e0e0e0;
    margin: 0; padding: 0;
  }
  header {
    background: linear-gradient(90deg,#1b263b,#415a77);
    color: #fff;
    padding: 25px;
    text-align: center;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
  }
  header h1 { margin:0; font-size:2rem; }
  header p { margin:5px 0 0; color:#a8dadc; font-weight:500; }

  .container { padding: 20px; max-width: 900px; margin:auto; }

  /* ===== Form ===== */
  form {
    background: #1b263b;
    padding: 20px;
    border-radius: 15px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.4);
    margin-bottom: 25px;
  }
  input, textarea, select {
    width: 100%;
    padding: 12px;
    margin: 10px 0;
    border-radius: 8px;
    border: none;
    background: #415a77;
    color: #e0e0e0;
  }
  input::placeholder, textarea::placeholder { color: #cbd5e0; }
  button {
    padding: 12px 25px;
    background: #1f7a8c;
    color: #fff;
    border:none;
    border-radius:10px;
    cursor:pointer;
    font-weight:bold;
    transition:0.3s;
  }
  button:hover { background:#3aa0c5; transform:scale(1.05); }

  /* ===== Task Cards ===== */
  .task {
    background: #1b263b;
    padding: 15px 20px;
    border-radius: 15px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    transition:0.3s;
    opacity: 0;
    transform: translateY(10px);
    animation: fadeIn 0.5s forwards;
  }
  .task:hover { transform:translateY(-2px); box-shadow:0 8px 20px rgba(0,0,0,0.5);}
  .completed { text-decoration: line-through; color:#7b8fa1; }

  .badge {
    padding: 5px 12px;
    border-radius: 12px;
    font-weight:bold;
    font-size:12px;
    color:#fff;
  }
  .badge.high { background:#e63946; }
  .badge.medium { background:#f4a261; }
  .badge.low { background:#2a9d8f; }

  /* ===== Scoreboard ===== */
  .scoreboard {
    text-align: center;
    font-size: 18px;
    margin-bottom: 20px;
    color:#a8dadc;
  }

  /* ===== Map ===== */
  #map {
    height: 400px;
    border-radius: 15px;
    box-shadow: 0 5px 20px rgba(0,0,0,0.4);
  }

  /* ===== Animations ===== */
  @keyframes fadeIn { to { opacity:1; transform:translateY(0); } }

</style>
</head>
<body>

<header>
  <h1>⚡ Smart Task Manager</h1>
  <p>Time ⏰ + Location 📍 + AI Suggestions 🤖 + Reminders 🔔</p>
</header>

<div class="container">
  <!-- Task Form -->
  <form id="taskForm">
    <input type="text" id="title" placeholder="Task Title" required>
    <textarea id="description" placeholder="Task Description"></textarea>
    <input type="datetime-local" id="deadline" required>
    <input type="text" id="location" placeholder="Enter Location (e.g., coffee shop)" required>
    <select id="priority">
      <option value="high">High Priority 🔴</option>
      <option value="medium">Medium Priority 🟠</option>
      <option value="low">Low Priority 🟢</option>
    </select>
    <label for="reminder">🔔 Reminder (minutes before deadline)</label>
    <input type="number" id="reminder" value="5" min="0">
    <button type="submit">➕ Add Task</button>
  </form>

  <!-- Task List -->
  <h2>📋 Your Tasks</h2>
  <div id="taskList"></div>

  <!-- Scoreboard -->
  <div class="scoreboard">
    🏆 Your Points: <span id="points">0</span>
  </div>

  <!-- Map -->
  <h2>🗺️ Task Map</h2>
  <div id="map"></div>
</div>

<!-- JS -->
<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-app.js";
import { getFirestore, collection, addDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/9.22.2/firebase-firestore.js";

// Firebase config
const firebaseConfig = { /* your keys here */ };
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

const taskForm = document.getElementById("taskForm");
const taskList = document.getElementById("taskList");
const pointsEl = document.getElementById("points");
let points = 0;
let tasks = [];

taskForm.addEventListener("submit", async (e) => {
  e.preventDefault();
  const newTask = {
    title: document.getElementById("title").value,
    description: document.getElementById("description").value,
    deadline: document.getElementById("deadline").value,
    location: document.getElementById("location").value,
    priority: document.getElementById("priority").value,
    reminder: parseInt(document.getElementById("reminder").value),
    completed: false,
    createdAt: new Date()
  };
  await addDoc(collection(db, "tasks"), newTask);
  taskForm.reset();
});

onSnapshot(collection(db, "tasks"), (snapshot) => {
  taskList.innerHTML = "";
  tasks = [];
  snapshot.forEach((doc) => {
    const task = { id: doc.id, ...doc.data() };
    tasks.push(task);
    renderTask(task);
  });
});

function renderTask(task) {
  const div = document.createElement("div");
  div.className = `task ${task.priority} ${task.completed ? "completed" : ""}`;
  div.innerHTML = `
    <div>
      <strong>${task.title}</strong> - ${task.description} <br>
      📅 ${task.deadline} | 📍 ${task.location}
    </div>
    <span class="badge ${task.priority}">${task.priority.toUpperCase()}</span>
  `;
  taskList.appendChild(div);
}

// Map
const map = L.map('map').setView([20.5937, 78.9629], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
let userMarker = null;

function getDistance(lat1, lon1, lat2, lon2) {
  const R = 6371;
  const dLat = (lat2-lat1) * Math.PI/180;
  const dLon = (lon2-lon1) * Math.PI/180;
  const a = Math.sin(dLat/2)**2 + Math.cos(lat1*Math.PI/180)*Math.cos(lat2*Math.PI/180)*Math.sin(dLon/2)**2;
  const c = 2*Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
  return R * c;
}

function notifyUser(message) {
  if (Notification.permission === "granted") new Notification(message);
  else alert(message);
}

async function geocodeLocation(locationName){
  const res = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(locationName)}`);
  const data = await res.json();
  if(data.length>0) return {lat: parseFloat(data[0].lat), lng: parseFloat(data[0].lon)};
  return null;
}

async function getAISuggestion(taskTitle, taskLocation){
  try {
    const response = await fetch("https://api.openai.com/v1/chat/completions", {
      method:"POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({
        model:"gpt-3.5-turbo",
        messages:[{role:"user", content:`Short actionable suggestion for task "${taskTitle}" at "${taskLocation}"`}]
      })
    });
    const data = await response.json();
    return data.choices[0].message.content;
  } catch(e){ console.error(e); return "Check this task soon!"; }
}

navigator.geolocation.watchPosition(async (pos)=>{
  const userLat = pos.coords.latitude;
  const userLng = pos.coords.longitude;

  if(userMarker) userMarker.setLatLng([userLat,userLng]);
  else userMarker = L.marker([userLat,userLng],{title:"You"}).addTo(map).bindPopup("📍 You are here");

  for(let task of tasks){
    if(!task.lat || !task.lng){
      const coords = await geocodeLocation(task.location);
      if(coords){ task.lat=coords.lat; task.lng=coords.lng; L.marker([coords.lat, coords.lng]).addTo(map).bindPopup(task.title); }
    }
    if(task.lat && task.lng){
      const distance = getDistance(userLat,userLng,task.lat,task.lng);
      if(distance < 1){
        const suggestion = await getAISuggestion(task.title, task.location);
        notifyUser(`📍 You are ${distance.toFixed(1)} km from "${task.title}". AI Suggestion: ${suggestion}`);
        points += 5; pointsEl.innerText = points;
      }
    }
  }
});
</script>
</body>
</html>


